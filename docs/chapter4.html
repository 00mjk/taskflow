<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cookbook &raquo; Conditional Tasking | Taskflow Handbook</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <span id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">
        <a href="https://taskflow.github.io"><img src="taskflow_logo.png" alt="" />Taskflow</a> <span class="m-breadcrumb">|</span> <a href="index.html" class="m-thin">Handbook</a>
      </span>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="Cookbook.html">Cookbook</a> &raquo;</span>
          Conditional Tasking
        </h1>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li><a href="#C4_CreateAConditionTask">Create a Condition Task</a></li>
            <li><a href="#C4_TaskSchedulingPolicy">Task Scheduling Policy</a></li>
            <li><a href="#C4_CommonPitfalls">Common Pitfalls</a></li>
          </ul>
        </div>
<p>Parallel workloads often require making control-flow decisions across dependent tasks. Taskflow supports an very efficient interface of conditional tasking for users to implement general control flow such as dynamic flows, cycles, and conditionals that are otherwise difficult to do with existing frameworks.</p><section id="C4_CreateAConditionTask"><h2><a href="#C4_CreateAConditionTask">Create a Condition Task</a></h2><p>A condition task evalutes a set of instructions and returns an integer index of the next immediate successor to execute. The index is defined with respect to the order of its successor construction.</p><pre class="m-code"> <span class="mi">1</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span> <span class="n">taskflow</span><span class="p">;</span>
 <span class="mi">2</span><span class="o">:</span> 
 <span class="mi">3</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">init</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;init&quot;</span><span class="p">);</span>
 <span class="mi">4</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span>
 <span class="mi">5</span><span class="o">:</span>
 <span class="mi">6</span><span class="o">:</span> <span class="c1">// creates a condition task that returns 0 or 1</span>
 <span class="mi">7</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span>
 <span class="mi">8</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;flipping a coin</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
 <span class="mi">9</span><span class="o">:</span>  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
<span class="mi">10</span><span class="o">:</span> <span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond&quot;</span><span class="p">);</span>
<span class="mi">11</span><span class="o">:</span>
<span class="mi">12</span><span class="o">:</span> <span class="c1">// creates a feedback loop</span>
<span class="mi">13</span><span class="o">:</span> <span class="n">init</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span>
<span class="mi">14</span><span class="o">:</span> <span class="n">cond</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">stop</span><span class="p">);</span>  <span class="c1">// cond--0--&gt;cond, cond--1--&gt;stop</span>
<span class="mi">15</span><span class="o">:</span>
<span class="mi">16</span><span class="o">:</span> <span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span></pre><div class="m-graph"><svg style="width: 18.875rem; height: 4.875rem;" viewBox="0.00 0.00 302.13 78.00">
<g transform="scale(1 1) rotate(0) translate(4 74)">
<title>Taskflow</title>
<g class="m-node">
<title>cond</title>
<polygon points="139.0938,-36 90.906,-18 139.0938,0 187.2816,-18 139.0938,-36"/>
<text text-anchor="middle" x="139.0938" y="-13.2">cond</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;cond</title>
<path stroke-dasharray="5,2" d="M128.317,-32.0417C124.2867,-42.9126 127.879,-54 139.0938,-54 146.804,-54 150.9113,-48.7595 151.4158,-41.9516"/>
<polygon points="154.8695,-41.3831 149.8706,-32.0417 147.9531,-42.4616 154.8695,-41.3831"/>
<text text-anchor="middle" x="139.0938" y="-57.2">0</text>
</g>
<g class="m-node m-flat">
<title>stop</title>
<ellipse cx="263.1062" cy="-18" rx="31.0404" ry="18"/>
<text text-anchor="middle" x="263.1062" y="-13.2">stop</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;stop</title>
<path stroke-dasharray="5,2" d="M187.3953,-18C198.7337,-18 210.7157,-18 221.7198,-18"/>
<polygon points="221.9178,-21.5001 231.9177,-18 221.9177,-14.5001 221.9178,-21.5001"/>
<text text-anchor="middle" x="209.6368" y="-21.2">1</text>
</g>
<g class="m-node m-flat">
<title>init</title>
<ellipse cx="27" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-13.2">init</text>
</g>
<g class="m-edge">
<title>init&#45;&gt;cond</title>
<path d="M54.1348,-18C62.2239,-18 71.4195,-18 80.701,-18"/>
<polygon points="80.7579,-21.5001 90.7579,-18 80.7578,-14.5001 80.7579,-21.5001"/>
</g>
</g>
</svg>
</div><p>The example above implements a simple yet commonly used feedback loop through a condition task (line 7-10) that returns a random binary value. If the return value from <code>cond</code> is 0, it loops back to itself, or otherwise to <code>stop</code>. Our conditional tasking interface is very neat and expressive. A complex flow control often just takes a few lines of code to implement. The code below creates another taskflow with three condition tasks.</p><pre class="m-code"> <span class="mi">1</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span> <span class="n">taskflow</span><span class="p">;</span>
 <span class="mi">2</span><span class="o">:</span>
 <span class="mi">3</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">A</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>
 <span class="mi">4</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">B</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">);</span>
 <span class="mi">5</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">C</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">);</span>
 <span class="mi">6</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">D</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">);</span>
 <span class="mi">7</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">E</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">);</span>
 <span class="mi">8</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">F</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;F&quot;</span><span class="p">);</span>
 <span class="mi">9</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">G</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;G&quot;</span><span class="p">);</span>
<span class="mi">10</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">H</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;H&quot;</span><span class="p">);</span>
<span class="mi">11</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">I</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">);</span>
<span class="mi">12</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">K</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;K&quot;</span><span class="p">);</span>
<span class="mi">13</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">L</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">);</span>
<span class="mi">14</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">M</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">);</span>
<span class="mi">15</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">cond_1</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_1&quot;</span><span class="p">);</span>
<span class="mi">16</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">cond_2</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_2&quot;</span><span class="p">);</span>
<span class="mi">17</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">cond_3</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_3&quot;</span><span class="p">);</span>
<span class="mi">18</span><span class="o">:</span>
<span class="mi">19</span><span class="o">:</span> <span class="n">A</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">F</span><span class="p">);</span>
<span class="mi">20</span><span class="o">:</span> <span class="n">B</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
<span class="mi">21</span><span class="o">:</span> <span class="n">C</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">D</span><span class="p">);</span>
<span class="mi">22</span><span class="o">:</span> <span class="n">D</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_1</span><span class="p">);</span>
<span class="mi">23</span><span class="o">:</span> <span class="n">E</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">K</span><span class="p">);</span>
<span class="mi">24</span><span class="o">:</span> <span class="n">F</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_2</span><span class="p">);</span>
<span class="mi">25</span><span class="o">:</span> <span class="n">H</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">I</span><span class="p">);</span>
<span class="mi">26</span><span class="o">:</span> <span class="n">I</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_3</span><span class="p">);</span>
<span class="mi">27</span><span class="o">:</span> <span class="n">L</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>
<span class="mi">28</span><span class="o">:</span>
<span class="mi">29</span><span class="o">:</span> <span class="n">cond_1</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">E</span><span class="p">);</span>
<span class="mi">30</span><span class="o">:</span> <span class="n">cond_2</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">H</span><span class="p">);</span>
<span class="mi">31</span><span class="o">:</span> <span class="n">cond_3</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_3</span><span class="p">,</span> <span class="n">L</span><span class="p">);</span>
<span class="mi">32</span><span class="o">:</span>
<span class="mi">33</span><span class="o">:</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">);</span></pre><p>Debrief:</p><ul><li>Line 29 creates a condition task that loops back to B on return 0, and proceeds to E on return 1</li><li>Line 30 creates a condition task that goes to G and H on return 0 and 1, respectively</li><li>Line 31 creates a condition task that loops back to itself on return 0, and proceeds to L on return 1</li></ul><div class="m-graph"><svg style="width: 59.438rem; height: 12.000rem;" viewBox="0.00 0.00 950.56 192.00">
<g transform="scale(1 1) rotate(0) translate(4 188)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fecbdc02830</title>
<ellipse cx="27" cy="-94" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-89.2">A</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02940</title>
<ellipse cx="118" cy="-122" rx="27" ry="18"/>
<text text-anchor="middle" x="118" y="-117.2">B</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02830&#45;&gt;p0x7fecbdc02940</title>
<path d="M51.8661,-101.6511C61.6764,-104.6697 73.1102,-108.1878 83.6848,-111.4415"/>
<polygon points="82.8919,-114.8594 93.479,-114.4551 84.9505,-108.1689 82.8919,-114.8594"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02d80</title>
<ellipse cx="118" cy="-68" rx="27" ry="18"/>
<text text-anchor="middle" x="118" y="-63.2">F</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02830&#45;&gt;p0x7fecbdc02d80</title>
<path d="M51.8661,-86.8954C61.5966,-84.1152 72.9244,-80.8787 83.4267,-77.8781"/>
<polygon points="84.5102,-81.2086 93.1639,-75.096 82.5871,-74.478 84.5102,-81.2086"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02a50</title>
<ellipse cx="246.9774" cy="-166" rx="27" ry="18"/>
<text text-anchor="middle" x="246.9774" y="-161.2">C</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02940&#45;&gt;p0x7fecbdc02a50</title>
<path d="M142.2597,-130.2761C162.2562,-137.0978 190.845,-146.8507 213.1004,-154.443"/>
<polygon points="212.232,-157.8448 222.8265,-157.761 214.4922,-151.2197 212.232,-157.8448"/>
</g>
<g class="m-node">
<title>p0x7fecbdc03600</title>
<polygon points="246.9774,-86 182.0226,-68 246.9774,-50 311.9322,-68 246.9774,-86"/>
<text text-anchor="middle" x="246.9774" y="-63.2">cond_2</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02d80&#45;&gt;p0x7fecbdc03600</title>
<path d="M145.0379,-68C153.097,-68 162.3502,-68 171.9228,-68"/>
<polygon points="171.9773,-71.5001 181.9773,-68 171.9772,-64.5001 171.9773,-71.5001"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02b60</title>
<ellipse cx="383.8532" cy="-166" rx="27" ry="18"/>
<text text-anchor="middle" x="383.8532" y="-161.2">D</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02a50&#45;&gt;p0x7fecbdc02b60</title>
<path d="M274.0197,-166C294.6937,-166 323.4408,-166 346.3393,-166"/>
<polygon points="346.3987,-169.5001 356.3986,-166 346.3986,-162.5001 346.3987,-169.5001"/>
</g>
<g class="m-node">
<title>p0x7fecbdc034f0</title>
<polygon points="512.8306,-155 447.8758,-137 512.8306,-119 577.7854,-137 512.8306,-155"/>
<text text-anchor="middle" x="512.8306" y="-132.2">cond_1</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02b60&#45;&gt;p0x7fecbdc034f0</title>
<path d="M409.6437,-160.2011C426.0453,-156.5133 447.7464,-151.6339 467.014,-147.3017"/>
<polygon points="467.8383,-150.7038 476.8269,-145.0953 466.3026,-143.8743 467.8383,-150.7038"/>
</g>
<g class="m-edge">
<title>p0x7fecbdc034f0&#45;&gt;p0x7fecbdc02940</title>
<path stroke-dasharray="5,2" d="M455.3875,-134.8177C373.1784,-131.6945 224.2807,-126.0377 155.1365,-123.4109"/>
<polygon points="155.264,-119.9133 145.1383,-123.031 154.9982,-126.9082 155.264,-119.9133"/>
<text text-anchor="middle" x="334.404" y="-133.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02c70</title>
<ellipse cx="687.6838" cy="-137" rx="27" ry="18"/>
<text text-anchor="middle" x="687.6838" y="-132.2">E</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc034f0&#45;&gt;p0x7fecbdc02c70</title>
<path stroke-dasharray="5,2" d="M577.9395,-137C602.36,-137 629.2701,-137 650.3313,-137"/>
<polygon points="650.465,-140.5001 660.465,-137 650.465,-133.5001 650.465,-140.5001"/>
<text text-anchor="middle" x="600.2572" y="-140.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc031c0</title>
<ellipse cx="824.5597" cy="-137" rx="27" ry="18"/>
<text text-anchor="middle" x="824.5597" y="-132.2">K</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02c70&#45;&gt;p0x7fecbdc031c0</title>
<path d="M714.7261,-137C735.4002,-137 764.1472,-137 787.0457,-137"/>
<polygon points="787.1051,-140.5001 797.1051,-137 787.1051,-133.5001 787.1051,-140.5001"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02e90</title>
<ellipse cx="383.8532" cy="-72" rx="27" ry="18"/>
<text text-anchor="middle" x="383.8532" y="-67.2">G</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03600&#45;&gt;p0x7fecbdc02e90</title>
<path stroke-dasharray="5,2" d="M305.8194,-69.7196C319.6316,-70.1232 333.9757,-70.5424 346.541,-70.9096"/>
<polygon points="346.5288,-74.4106 356.6268,-71.2043 346.7334,-67.4136 346.5288,-74.4106"/>
<text text-anchor="middle" x="334.404" y="-73.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02fa0</title>
<ellipse cx="383.8532" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="383.8532" y="-13.2">H</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03600&#45;&gt;p0x7fecbdc02fa0</title>
<path stroke-dasharray="5,2" d="M275.0066,-57.7611C296.9061,-49.7613 327.406,-38.6199 350.5501,-30.1654"/>
<polygon points="351.7802,-33.4424 359.9722,-26.7236 349.3783,-26.8674 351.7802,-33.4424"/>
<text text-anchor="middle" x="334.404" y="-40.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc030b0</title>
<ellipse cx="512.8306" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="512.8306" y="-13.2">I</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02fa0&#45;&gt;p0x7fecbdc030b0</title>
<path d="M410.8911,-18C429.7222,-18 455.0732,-18 475.7829,-18"/>
<polygon points="475.8284,-21.5001 485.8283,-18 475.8283,-14.5001 475.8284,-21.5001"/>
</g>
<g class="m-node">
<title>p0x7fecbdc03710</title>
<polygon points="687.6838,-36 622.7291,-18 687.6838,0 752.6386,-18 687.6838,-36"/>
<text text-anchor="middle" x="687.6838" y="-13.2">cond_3</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc030b0&#45;&gt;p0x7fecbdc03710</title>
<path d="M540.1514,-18C559.5692,-18 586.6542,-18 612.3242,-18"/>
<polygon points="612.4507,-21.5001 622.4507,-18 612.4506,-14.5001 612.4507,-21.5001"/>
</g>
<g class="m-edge">
<title>p0x7fecbdc03710&#45;&gt;p0x7fecbdc03710</title>
<path stroke-dasharray="5,2" d="M673.4642,-32.4167C668.4987,-43.166 673.2385,-54 687.6838,-54 697.3893,-54 702.7135,-49.1094 703.6566,-42.6397"/>
<polygon points="707.0434,-41.6812 701.9035,-32.4167 700.1441,-42.8644 707.0434,-41.6812"/>
<text text-anchor="middle" x="687.6838" y="-57.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc032d0</title>
<ellipse cx="824.5597" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="824.5597" y="-13.2">L</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03710&#45;&gt;p0x7fecbdc032d0</title>
<path stroke-dasharray="5,2" d="M752.9148,-18C764.689,-18 776.5901,-18 787.2199,-18"/>
<polygon points="787.3743,-21.5001 797.3742,-18 787.3742,-14.5001 787.3743,-21.5001"/>
<text text-anchor="middle" x="775.1105" y="-21.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc033e0</title>
<ellipse cx="915.5597" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="915.5597" y="-13.2">M</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc032d0&#45;&gt;p0x7fecbdc033e0</title>
<path d="M851.8627,-18C860.141,-18 869.3814,-18 878.2002,-18"/>
<polygon points="878.276,-21.5001 888.2759,-18 878.2759,-14.5001 878.276,-21.5001"/>
</g>
</g>
</svg>
</div><p>You can use condition tasks to create cycles as long as the graph does not introduce task race during execution. However, cycles are not allowed in non-condition tasks.</p></section><section id="C4_TaskSchedulingPolicy"><h2><a href="#C4_TaskSchedulingPolicy">Task Scheduling Policy</a></h2><p>In order to understand how an executor schedules condition tasks, we define two dependency types, <em>strong dependency</em> and <em>weak dependency</em>. A strong dependency is a preceding link from a non-condition task to another task. A weak dependency is a preceding link from a condition task to another task. The number of dependents of a task is the sum of strong dependency and weak dependency. The table below lists the strong dependency and weak dependency numbers of each task in the previous example.</p><table class="m-table"><thead><tr><th>task</th><th>strong dependency</th><th>weak dependency</th><th>dependents</th></tr></thead><tbody><tr><td>A</td><td>0</td><td>0</td><td>0</td></tr><tr><td>B</td><td>1</td><td>1</td><td>2</td></tr><tr><td>C</td><td>1</td><td>0</td><td>1</td></tr><tr><td>D</td><td>1</td><td>0</td><td>1</td></tr><tr><td>E</td><td>0</td><td>1</td><td>1</td></tr><tr><td>F</td><td>1</td><td>0</td><td>1</td></tr><tr><td>G</td><td>0</td><td>1</td><td>1</td></tr><tr><td>H</td><td>0</td><td>1</td><td>1</td></tr><tr><td>I</td><td>1</td><td>0</td><td>1</td></tr><tr><td>K</td><td>1</td><td>0</td><td>1</td></tr><tr><td>L</td><td>0</td><td>1</td><td>1</td></tr><tr><td>M</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_1</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_2</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_3</td><td>1</td><td>1</td><td>2</td></tr></tbody></table><p>You can query the number of strong dependents, the number of weak dependents, and the number of dependents of a task.</p><pre class="m-code"><span class="mi">1</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span> <span class="n">taskflow</span><span class="p">;</span>
<span class="mi">2</span><span class="o">:</span> 
<span class="mi">3</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">task</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){});</span>
<span class="mi">4</span><span class="o">:</span> 
<span class="mi">5</span><span class="o">:</span> <span class="c1">// ... add more tasks and preceding links</span>
<span class="mi">6</span><span class="o">:</span>
<span class="mi">7</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">task</span><span class="p">.</span><span class="n">num_dependents</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="mi">8</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">task</span><span class="p">.</span><span class="n">num_strong_dependents</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> 
<span class="mi">9</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">task</span><span class="p">.</span><span class="n">num_weak_dependents</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span></pre><p>When you submit a task to an executor, the scheduler starts with tasks of <em>zero dependents</em> (both zero strong and weak dependencies) and continues to execute successive tasks whenever their <em>strong dependencies</em> are met. However, the scheduler skips this rule when executing a condition task and jumps directly to its successors indexed by the return value.</p><img class="m-image" src="conditional-tasking-rules.svg" alt="Image" style="width: 100%;" /><p>Each task has an <em>atomic</em> join counter to keep track of strong dependents that are met at runtime. When a task completes, the join counter is restored to the task&#x27;s strong dependency number in the graph, such that the subsequent execution can reuse the counter again.</p></section><section id="C4_CommonPitfalls"><h2><a href="#C4_CommonPitfalls">Common Pitfalls</a></h2><p>Condition tasks are handy in creasing dynamic and cyclic control flows, but they are also easy to make mistakes. It is your responsibility to ensure a taskflow is properly conditioned. Top things to avoid include <em>no source tasks</em> to start with and <em>task race</em>. The figure below shows common pitfalls and their remedies.</p><img class="m-image" src="conditional-tasking-pitfalls.svg" alt="Image" style="width: 100%;" /><p>In the error1 scenario, there is no source task for the scheduler to start with, and the simplest fix is to add a task S that has no dependents. In the error2 scenario, D might be scheduled twice by E through the strong dependency and C through the weak dependency (on return 1). To fix this problem, you can add an auxiliary task D-aux to break the mixed use of strong dependency and weak dependency. In the risky scenario, task X may not be raced if P and M is exclusively branching to X.</p><p>A good practice for avoiding mistakes of conditional tasking is to infer the execution flow of your graphs based on our scheduling rules. Make sure there is no task race.</p></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Taskflow handbook is part of the <a href="https://taskflow.github.io">Taskflow project</a>, copyright © <a href="https://tsung-wei-huang.github.io/">Dr. Tsung-Wei Huang</a>, 2018&ndash;2020.<br />Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.14 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
